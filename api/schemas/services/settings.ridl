webrpc = v1
name = langkit-settings
version = v1.0.0

# Settings and configuration service

struct APIKeys
  - replicate?: string
  - elevenLabs?: string
  - openAI?: string
  - openRouter?: string
  - google?: string

struct EventThrottling
  - enabled: bool
  - minInterval: int32  # milliseconds
  - maxInterval: int32  # milliseconds

struct CustomEndpointConfig
  - enabled: bool
  - endpoint: string
  - model: string

struct CustomEndpoints
  - stt: CustomEndpointConfig
  - llm: CustomEndpointConfig

struct Settings
  - apiKeys: APIKeys
  - targetLanguage: string
  - nativeLanguages: string
  - liteMode: bool
  - showLogViewerByDefault: bool
  - maxLogEntries: int32
  - maxAPIRetries: int32
  - maxWorkers: int32
  - timeoutSep: int32  # seconds
  - timeoutSTT: int32  # seconds
  - timeoutDL: int32   # seconds
  - demucsMaxSegmentMinutes: int32  # max minutes per segment to avoid GPU OOM
  - logViewerVirtualizationThreshold: int32
  - eventThrottling: EventThrottling
  - intermediaryFileMode: string  # keep, recompress, delete
  - deleteResumptionFiles: bool
  - useWasm: bool
  - wasmSizeThreshold: int32
  - forceWasmMode: string
  - ffmpegPath: string
  - mediainfoPath: string
  - customEndpoints: CustomEndpoints
  - lastSeenVersion: string
  - changelogDisplayFrequency: string  # all, minor_major, major_only

struct StatisticsUpdate
  - updates: map<string,any>

struct IncrementResult
  - newValue: int32

service SettingsService
  # Settings management
  - InitSettings() => ()
  - LoadSettings() => (settings: Settings)
  - SaveSettings(settings: Settings) => ()
  
  # Statistics management
  - LoadStatistics() => (statistics: map<string,any>)
  - UpdateStatistics(updates: map<string,any>) => ()
  - IncrementStatistic(key: string) => (result: IncrementResult)